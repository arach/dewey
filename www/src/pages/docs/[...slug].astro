---
import DocsLayout from '../../layouts/DocsLayout.astro'

export async function getStaticPaths() {
  const pages = import.meta.glob('../../../docs/**/*.md')

  const entries = Object.entries(pages).filter(([filePath]) => {
    if (filePath.includes('/docs/agent/')) return false
    if (filePath.endsWith('.agent.md')) return false
    if (filePath.endsWith('/docs/AGENTS.md')) return false
    return true
  })

  return Promise.all(
    entries.map(async ([filePath, loader]) => {
      const page = await loader()
      const slug = filePath.split('/docs/')[1].replace(/\.md$/, '')

      return {
        params: { slug },
        props: { page },
      }
    }),
  )
}

const { page } = Astro.props
const { Content, frontmatter } = page
const headings = (await page.getHeadings?.()) ?? page.headings ?? []
const fileName = page.file.split('/').pop()?.replace(/\.md$/, '') ?? 'Docs'
const fallbackTitle = fileName
  .split('-')
  .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))
  .join(' ')
const title = frontmatter?.title ?? fallbackTitle
---

<DocsLayout title={title} headings={headings}>
  <Content />
</DocsLayout>
